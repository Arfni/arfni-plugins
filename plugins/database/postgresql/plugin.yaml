# ARFNI Plugin Manifest - PostgreSQL Database
apiVersion: v0.1
name: postgresql
version: 1.0.0
category: database
description: PostgreSQL relational database
author: arfni-community
homepage: https://github.com/Arfni/arfni-plugins/tree/main/plugins/database/postgresql
license: MIT

# Plugin provides
provides:
  service_kinds:
    - db.postgres
  frameworks: []

# Compatibility
requires:
  arfni_version: ">=0.2.0"
  docker_version: ">=20.10"

# User inputs
inputs:
  postgres_version:
    description: "PostgreSQL version"
    type: select
    options:
      - "13"
      - "14"
      - "15"
      - "16"
    default: "15"
    required: true

  db_name:
    description: "Database name"
    type: text
    default: "myapp"
    required: true

  db_user:
    description: "Database username"
    type: text
    default: "postgres"
    required: true

  db_password:
    description: "Database password"
    type: secret
    required: true
    env_var: POSTGRES_PASSWORD

  db_port:
    description: "PostgreSQL port"
    type: number
    default: 5432
    required: false

  enable_backup:
    description: "Enable automatic database backups"
    type: boolean
    default: false
    required: false

# Service contributions to stack.yaml
contributes:
  services:
    postgres:
      kind: db.postgres
      target: "{{target}}"
      spec:
        image: "postgres:{{postgres_version}}-alpine"
        ports:
          - "{{db_port}}:5432"
        environment:
          POSTGRES_DB: "{{db_name}}"
          POSTGRES_USER: "{{db_user}}"
          POSTGRES_PASSWORD: "{{db_password}}"
          POSTGRES_INITDB_ARGS: "--encoding=UTF-8 --lc-collate=C --lc-ctype=C"
        volumes:
          - host: postgres_data
            mount: /var/lib/postgresql/data
        health:
          tcp:
            port: 5432
          initialDelaySeconds: 5
          periodSeconds: 5

  volumes:
    - postgres_data

# Lifecycle hooks
hooks:
  post_deploy:
    script: hooks/verify-connection.sh
    description: "Verify PostgreSQL connection"

  health_check:
    script: hooks/health-check.sh
    description: "Check PostgreSQL health status"

# Tags for discovery
tags:
  - database
  - postgresql
  - postgres
  - sql
  - relational
  - rdbms
  - acid

# Documentation
documentation:
  readme: README.md

# Changelog
changelog: CHANGELOG.md
